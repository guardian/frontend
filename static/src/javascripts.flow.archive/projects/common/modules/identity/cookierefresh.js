/**
 * DO NOT EDIT THIS FILE
 *
 * It is not used to to build anything.
 *
 * It's just a record of the old flow types.
 *
 * Use it as a guide when converting
 * - static/src/javascripts/projects/common/modules/identity/cookierefresh.js
 * to .ts, then delete it.
 */

// @flow

import {
    isUserLoggedIn,
    getUserFromApiWithRefreshedCookie,
} from 'common/modules/identity/api';
import { storage } from '@guardian/libs'

const shouldRefreshCookie = (
    lastRefresh: ?number,
    currentTime: number
): boolean => {
    const days30k = 1000 * 86400 * 30; // (as seconds)
    return !lastRefresh || currentTime > parseInt(lastRefresh, 10) + days30k;
};

const init = (): void => {
    const lastRefreshKey = 'identity.lastRefresh';

    if (storage.local.isAvailable() && isUserLoggedIn()) {
        const currentTime = new Date().getTime();
        const lastRefresh = storage.local.get(lastRefreshKey);
        if (shouldRefreshCookie(lastRefresh, currentTime)) {
            getUserFromApiWithRefreshedCookie();
            storage.local.set(lastRefreshKey, currentTime);
        }
    }
};

export { shouldRefreshCookie, init };
