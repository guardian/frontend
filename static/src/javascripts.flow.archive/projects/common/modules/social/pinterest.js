/**
 * DO NOT EDIT THIS FILE
 *
 * It is not used to to build anything.
 *
 * It's just a record of the old flow types.
 *
 * Use it as a guide when converting
 * - static/src/javascripts/projects/common/modules/social/pinterest.js
 * to .ts, then delete it.
 */

// @flow

import fastdom from 'fastdom';
import { loadScript } from '@guardian/libs';

const launchOverlay = (event: Event): void => {
    event.preventDefault();

    const scriptUrl = 'https://assets.pinterest.com/js/pinmarklet.js';
    const cachePurge = new Date().getTime();
    const images = Array.from(
        document.querySelectorAll('img:not(.gu-image):not(.responsive-img)')
    );

    fastdom.mutate(() => {
        images.forEach(img => {
            img.setAttribute('data-pin-nopin', 'true');
        });
    });

    loadScript(`${scriptUrl}?r=${cachePurge}`);
};

const initPinterest = (): void => {
    const buttons = Array.from(
        document.querySelectorAll('.social__item--pinterest')
    );

    fastdom.mutate(() => {
        buttons.forEach(el => {
            el.addEventListener('click', launchOverlay);
        });
    });
};

export { initPinterest };
