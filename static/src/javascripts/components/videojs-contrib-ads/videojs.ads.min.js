/*! videojs-contrib-ads - v3.0.0 - 2015-10-08
* Copyright (c) 2015 Brightcove; Licensed  */
!function(a,b){"function"==typeof define&&define.amd?define("videojs-contrib-ads",["videojs"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("video.js")):a["videojs-contrib-ads"]=b(videojs)}(this,function(a){!function(a,b,c,d){"use strict";var e=function(a){var b,c,d;for(c=1;c<arguments.length;c++){b=arguments[c];for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},f=function(a,b,c){var d,e,f=Object.prototype.toString.call(b),g=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c);else if(a.on)a.on(b,c);else{if(!a.attachEvent)throw new Error("object has no mechanism for adding event listeners");a.attachEvent("on"+b,c)}};switch(f){case"[object String]":g(a,b,c);break;case"[object Array]":for(d=0,e=b.length;e>d;d++)g(a,b[d],c);break;case"[object Object]":for(d in b)b.hasOwnProperty(d)&&g(a,d,b[d]);break;default:throw new Error("Unrecognized events parameter type: "+f)}return a},g=function(b){return a.setTimeout(b,1)},h=function(b){return a.clearTimeout(b)},i=function(a){a.ads.cancelPlayTimeout||(a.ads.cancelPlayTimeout=g(function(){a.ads.cancelPlayTimeout=null,a.paused()||a.pause(),a.one("contentplayback",function(){a.paused()&&a.play()})}))},j=function(a){var b,c,d=a.el().querySelector(".vjs-tech"),e=a.remoteTextTracks?a.remoteTextTracks():[],f=[],g={ended:a.ended(),src:a.currentSrc(),currentTime:a.currentTime(),type:a.currentType()};for(d&&(g.nativePoster=d.poster,g.style=d.getAttribute("style")),c=e.length;c--;)b=e[c],f.push({track:b,mode:b.mode}),b.mode="disabled";return g.suppressedTracks=f,g},k=function(a,b){for(var c=a.className.split(/\s+/),d=c.length,e=[];d--;)c[d]!==b&&e.push(c[d]);a.className=e.join(" ")},l=function(b,e){var f,g,h=b.el().querySelector(".vjs-tech"),i=20,j=e.suppressedTracks,k=function(){for(var a=j.length;a--;)f=j[a],f.track.mode=f.mode},l=function(){var c=!1,d=function(){c=!0};b.currentTime(e.currentTime),e.ended?(b.ads.resumeEndedTimeout=a.setTimeout(function(){c||b.play(),b.off("ended",d),b.ads.resumeEndedTimeout=null},250),b.on("ended",d),b.on("dispose",function(){a.clearTimeout(b.ads.resumeEndedTimeout)})):b.play()},m=function(){return h.readyState>1?l():h.seekable===d?l():h.seekable.length>0?l():void(i--?a.setTimeout(m,50):!function(){try{l()}catch(a){c.log.warn("Failed to resume the content after an advertisement",a)}}())};e.nativePoster&&(h.poster=e.nativePoster),"style"in e&&h.setAttribute("style",e.style||""),g=b.src()?b.src()!==e.src:b.currentSrc()!==e.src,g?(b.one("contentloadedmetadata",k),b.src({src:e.src,type:e.type}),b.load(),b.one("contentcanplay",m)):b.ended()&&e.ended||(k(),b.play())},m=function(a){var b=a.el().querySelector(".vjs-tech");b&&b.removeAttribute("poster")},n={timeout:5e3,prerollTimeout:100,postrollTimeout:100,debug:!1},o=function(b){var d,o=this,p=e({},n,b||{});!function(){var a,b=c.getComponent("Html5").Events,d=function(){return!0},e=function(a,b){b.isImmediatePropagationStopped=d,b.cancelBubble=!0,b.isPropagationStopped=d,o.trigger({type:a+b.type,state:o.ads.state,originalEvent:b})},f=function(a){if("ad-playback"===o.ads.state)e("ad",a);else if("content-playback"===o.ads.state&&"ended"===a.type)e("content",a);else if("content-resuming"===o.ads.state){if(o.ads.snapshot){if(o.currentSrc()!==o.ads.snapshot.src){if("loadstart"===a.type)return;return e("content",a)}if(o.ads.snapshot.ended)return"pause"===a.type||"ended"===a.type?void o.addClass("vjs-has-started"):e("content",a)}"playing"!==a.type&&e("content",a)}};for(b.push("firstplay"),b.push("loadedalldata"),a=b.length;a--;)o.on(b[a],f);return f}(),o.on(["addurationchange","adcanplay"],function(){var a=o.ads.snapshot;o.currentSrc()!==a.src&&o.play()}),o.ads={state:"content-set",startLinearAdMode:function(){"ad-playback"!==o.ads.state&&o.trigger("adstart")},endLinearAdMode:function(){"ad-playback"===o.ads.state&&o.trigger("adend")},skipLinearAdMode:function(){"ad-playback"!==o.ads.state&&o.trigger("adskip")}},d=function(b){var d={"content-set":{events:{adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",i(o),m(o)},adserror:function(){this.state="content-playback"},adskip:function(){this.state="content-playback"}}},"ads-ready":{events:{play:function(){this.state="preroll?",i(o)},adskip:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"preroll?":{enter:function(){o.el().className+=" vjs-ad-loading",o.ads.adTimeoutTimeout=a.setTimeout(function(){o.trigger("adtimeout")},p.prerollTimeout),o.trigger("readyforpreroll")},leave:function(){a.clearTimeout(o.ads.adTimeoutTimeout),k(o.el(),"vjs-ad-loading")},events:{play:function(){i(o)},adstart:function(){this.state="ad-playback"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ads-ready?":{enter:function(){o.el().className+=" vjs-ad-loading",o.ads.adTimeoutTimeout=a.setTimeout(function(){o.trigger("adtimeout")},p.timeout)},leave:function(){a.clearTimeout(o.ads.adTimeoutTimeout),k(o.el(),"vjs-ad-loading")},events:{play:function(){i(o)},adscanceled:function(){this.state="content-playback"},adsready:function(){this.state="preroll?"},adskip:function(){this.state="content-playback"},adtimeout:function(){this.state="content-playback"},adserror:function(){this.state="content-playback"}}},"ad-playback":{enter:function(){this.snapshot=j(o),o.el().className+=" vjs-ad-playing",m(o),o.ads.cancelPlayTimeout&&(h(o.ads.cancelPlayTimeout),o.ads.cancelPlayTimeout=null)},leave:function(){k(o.el(),"vjs-ad-playing"),l(o,this.snapshot),"adend"!==o.ads.triggerevent&&o.trigger("adend")},events:{adend:function(){this.state="content-resuming"},adserror:function(){this.state="content-resuming"}}},"content-resuming":{enter:function(){this.snapshot.ended&&(a.clearTimeout(o.ads._fireEndedTimeout),o.ads._fireEndedTimeout=a.setTimeout(function(){o.trigger("ended")},1e3))},leave:function(){a.clearTimeout(o.ads._fireEndedTimeout)},events:{contentupdate:function(){this.state="content-set"},playing:function(){this.state="content-playback"},ended:function(){this.state="content-playback"}}},"postroll?":{enter:function(){this.snapshot=j(o),o.el().className+=" vjs-ad-loading",o.ads.adTimeoutTimeout=a.setTimeout(function(){o.trigger("adtimeout")},p.postrollTimeout)},leave:function(){a.clearTimeout(o.ads.adTimeoutTimeout),k(o.el(),"vjs-ad-loading")},events:{adstart:function(){this.state="ad-playback"},adskip:function(){this.state="content-resuming",g(function(){o.trigger("ended")})},adtimeout:function(){this.state="content-resuming",g(function(){o.trigger("ended")})},adserror:function(){this.state="content-resuming",g(function(){o.trigger("ended")})}}},"content-playback":{enter:function(){o.ads.cancelPlayTimeout&&(h(o.ads.cancelPlayTimeout),o.ads.cancelPlayTimeout=null),o.trigger({type:"contentplayback",triggerevent:o.ads.triggerevent})},events:{adsready:function(){o.trigger("readyforpreroll")},adstart:function(){this.state="ad-playback"},contentupdate:function(){this.state=o.paused()?"content-set":"ads-ready?"},contentended:function(){this.state="postroll?"}}}};!function(a){var e=function(){};((d[a].events||{})[b.type]||e).apply(o.ads),a!==o.ads.state&&(o.ads.triggerevent=b.type,(d[a].leave||e).apply(o.ads),(d[o.ads.state].enter||e).apply(o.ads),p.debug&&c.log("ads",o.ads.triggerevent+" triggered: "+a+" -> "+o.ads.state))}(o.ads.state)},f(o,c.getComponent("Html5").Events.concat(["adtimeout","contentupdate","contentplaying","contentended","adsready","adserror","adscanceled","adstart","adend","adskip"]),d),o.ads.contentSrc=o.currentSrc(),function(){var a=function(){var a;"ad-playback"!==o.ads.state&&(a=o.currentSrc(),a!==o.ads.contentSrc&&(o.trigger({type:"contentupdate",oldValue:o.ads.contentSrc,newValue:a}),o.ads.contentSrc=a))};o.on("loadstart",a),g(a)}(),o.paused()||d({type:"play"})};c.plugin("ads",o)}(window,document,a)});