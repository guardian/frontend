@(img: Option[model.ImageContainer],
  isShowcase: Boolean = false,
  isFeature: Boolean = false,
  isImageContent: Boolean = false,
  url: Option[String] = None,
  isLightboxable: Boolean = false)(implicit request: RequestHeader)


@import layout.WidthsByBreakpoint
@import layout.ContentWidths.{PictureMedia, MainMedia}
@import views.support.ImgSrc

@img.map{ picture =>

    <figure itemprop="associatedMedia image" itemscope itemtype="http://schema.org/ImageObject" data-component="image"
        class="media-primary media-content@if(isShowcase){ media-primary--showcase}">

        <meta itemprop="representativeOfPage" content="true">

        @if(isFeature && isShowcase) {
            @lightbox(picture, MainMedia.FeatureShowcase)
            <div class="gs-container">
                <div class="content__main-column">
                    @caption(picture)
                </div>
            </div>
        } else {
            @if(isImageContent ) {
                @lightbox(picture, PictureMedia.Inline)
            } else {
                @if(isShowcase) {
                    @lightbox(picture, MainMedia.Showcase)
                } else {
                    @lightbox(picture, MainMedia.Inline)
                }
            }
            @caption(picture)
        }
    </figure>
}

@lightbox(picture: model.ImageContainer, widths: WidthsByBreakpoint) =  {

    @if(isLightboxable) {
        <a href="@url#img-1" class="article__img-container js-gallerythumbs" data-link-name="Launch Article Lightbox" data-is-ajax>
            <div class="@if(isFeature && isShowcase){u-responsive-ratio u-responsive-ratio--letterbox}">
                @image(picture, widths)
                @fragments.inlineSvg("expand-image", "icon", List("centered-icon rounded-icon article__fullscreen"))
            </div>
        </a>
    } else {
        @image(picture, widths)
    }

}

@image(picture: model.ImageContainer, widths: WidthsByBreakpoint) = {

    <img src="@ImgSrc.getFallbackUrl(picture)"
        srcset="@ImgSrc.srcset(picture, widths)"
        sizes="@widths.sizes"
        class="maxed responsive-img"
        itemprop="contentUrl"
        alt="@ImgSrc.getFallbackAsset(picture).flatMap(_.altText).getOrElse("")" />

}

@caption(picture: model.ImageContainer) = {
    @ImgSrc.getFallbackAsset(picture).map { img =>
        @if(img.showCaption) {
            <figcaption class="caption caption--main caption--img" itemprop="description">
                @img.caption.map(Html(_))
                @if(img.displayCredit && !img.creditEndsWithCaption) { @img.credit.map(Html(_)) }
            </figcaption>
        }
    }
}
