@(page: model.Page)(implicit request: RequestHeader)
@import conf.switches.Switches._
@import common.InlineJs
@import templates.inlineJS.blocking.js._

<!--[if lt IE 9]>
    <script src="@Static("javascripts/components/html5shiv/html5shiv.js")"></script>
<![endif]-->

@* NOTE the order of these includes is important  *@
<script id="gu">
    // render-critical blocking JS

    // polyfills
    @Html(polyfills().body)

    // determine whether to run enhanced JS
    @InlineJs(shouldEnhance(page.metadata).body, "shouldEnhance.js")

    // page config
    @Html(config(page).body)

    // apply render conditions
    @InlineJs(applyRenderConditions().body, "applyRenderConditions.js")

    // try and load fonts before we use the stylesheets
    @if(FontSwitch.isSwitchedOn) {
        @InlineJs(loadFonts().body, "loadFonts.js")
    }

    @if(AsyncCss.isSwitchedOn) {
        // enable non-blocking stylesheets
        // borrows *heavily* from https://github.com/filamentgroup/loadCSS.
        @InlineJs(enableStylesheets().body, "enableStylesheets.js")
    }

    // cloudwatch beacons
    @InlineJs(cloudwatchBeacons(page.metadata).body, "cloudwatchBeacons.js")

    // finally, load the standard.js app async
    // do this last so that any config stuff it needs is definitely on `window.`
    @Html(curlConfig().body)

    @if(play.Play.isDev()) {
        // in prod, these are concatenated in /grunt-configs/concat.js
        @Html(omniture().body)
        </script>
        <script src="@Static("javascripts/bootstraps/standard/omniture-pageview.js")"></script>
        <script>
        @Html(Static.js.curl);
        require(['boot']);
    } else {
        // Polyfill for async script
        (function (document) {
            var script = document.createElement('script');
            script.src = '@Static("javascripts/app.js")';
            var ref = document.getElementsByTagName('script')[0];
            ref.parentNode.insertBefore(script, ref);
        })(document);
    }
</script>
