@(metaData: model.MetaData)(implicit request: RequestHeader)
@import common._

@defining(Edition(request).navigation) { navigation =>
    @defining(Navigation.topLevelItem(navigation, metaData)) { topLevelSelected =>
        <div class="new-navigation new-navigation--collapsed @if(topLevelSelected.size == 0){new-navigation--has-no-local-navigation}">
            <div class="gs-container">
                <div class="new-navigation__inner">
                    <div class="new-navigation__scroll">
                        <div class="new-navigation__container">
                            <div class="local-navigation">
                                @* current top link (if any) *@
                                @topLevelSelected.map {section =>
                                    <a class="local-navigation__parent" href="@LinkTo(section.name.href)"><span class="new-navigation__top-hat"></span>@section.name.title</a>
                                }

                                @* second level nav *@
                                @topLevelSelected.filter(_.links.nonEmpty).map{ localNav =>
                                    <ul class="local-navigation__children">
                                        @defining(localNav.links.find(_.currentFor(metaData))){ currentSublink =>

                                            @* current second level link (if any) *@
                                            @currentSublink.map {s =>
                                                <li class="local-navigation__child local-navigation__child--current">
                                                    <span class="new-navigation__top-hat"></span>
                                                    <a class="local-navigation__action" href="@LinkTo(s.href)">@s.title</a>
                                                </li>
                                            }

                                            @* remaining sub sections *@
                                            @Navigation.rotateByOmittingCurrent(localNav, currentSublink).map{ link =>
                                                <li class="local-navigation__child"><a class="local-navigation__action" href="@LinkTo(link.href)">@Html(link.title)</a></li>
                                            }
                                        }
                                    </ul>
                                }
                            </div>
                        </div>
                        <div class="new-navigation__container">
                            <ul class="global-navigation">
                                @navigation.filter(_.name.href != topLevelSelected.map(_.name.href).getOrElse("")).map { nav =>
                                    <li class="global-navigation__section">
                                        <a href="@LinkTo(nav.name.href)" class="global-navigation__title">@Html(nav.name.title)</a>
                                        @if(nav.links.nonEmpty) {
                                            <ul class="global-navigation__children">
                                                @nav.links.map{ link =>
                                                    <li class="global-navigation__child">
                                                        <a class="global-navigation__action" href="@LinkTo(link.href)">@Html(link.title)</a>
                                                    </li>
                                                }
                                            </ul>
                                        }
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>

                    <a class="new-navigation__toggle js-new-navigation-toggle" href="#footer-nav">
                        <span class="new-navigation__toggle-label new-navigation__toggle-label--open">all<span class="new-navigation__toggle-label__extra"> sections</span></span>
                        <span class="new-navigation__toggle-label new-navigation__toggle-label--close">close<span class="new-navigation__toggle-label__extra"> sections</span></span>
                    </a>
                </div>
            </div>
        </div>
    }
}
