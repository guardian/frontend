@(page: model.MetaData)(implicit request: RequestHeader)

@import common.LinkTo
@import common.Edition
@import common.editions._
@import views.support.RenderClasses
@import views.html.fragments.topNav.editionMenu
@import navigation.UrlHelpers.oldNav._
@import navigation.ReaderRevenueSite.{Membership, Subscribe}
@import navigation.UrlHelpers.{getReaderRevenueUrl, SlimHeaderDropdown}

@ellipsis() = {
    <a class="brand-bar__item--action popup__toggle"
    data-toggle="top-bar__popup--more" data-link-name="topNav : more"
    aria-haspopup="true" aria-controls="guardian-services-top-menu">
        <span class="rounded-icon control__icon-wrapper">
            @* CRAZY HACK TO FIX IE8 RENDERING ISSUE WITH LOGO SVG MARKUP *@
                <!--[if (gt IE 8)&(IEMobile)]><!-->
            @fragments.inlineSvg("ellipsis-36", "icon")
                <!--<![endif]-->
        </span>
        <span class="control__info" data-test-id="sign-in-name">more</span>
    </a>
}

<div class="brand-bar__item--right"
     data-component="guardian-services">
    @if(Edition(request) == Uk){
        <div class="brand-bar__item brand-bar__item--jobs hide-until-tablet hide-on-slim-header">
            <a class="brand-bar__item--action" data-link-name="uk : topNav : jobs"
               href="@jobsUrl("uk")">find a job</a>
        </div>
        <div class="brand-bar__item brand-bar__item--soulmates hide-until-desktop hide-on-slim-header">
            <a class="brand-bar__item--action" data-link-name="uk : topNav : soulmates"
               href="@soulmatesUrl("uk")">dating</a>
        </div>
        <div class="brand-bar__item has-popup brand-bar__item--has-control brand-bar__item--more">
            @ellipsis()
            <div class="popup popup--default is-off top-bar__popup--more" id="guardian-services-top-menu">
                <h3 class="popup__group-header">from the guardian:</h3>
                <ul class="popup__group">
                    <li class="popup__item brand-bar__popup--soulmates hide-from-desktop show-on-slim-header">
                        <a class="brand-bar__item--action" data-link-name="uk : topNav : soulmates"
                           href="@soulmatesUrl("uk")">dating</a>
                    </li>
                    <li class="popup__item">
                        <a class="brand-bar__item--action" data-link-name="uk : topNav : masterclasses"
                           href="@masterclassesUrl">masterclasses</a>
                    </li>
                    <li class="popup__item">
                        <a class="brand-bar__item--action" data-link-name="uk : topNav : courses"
                        href="https://courses.theguardian.com?INTCMP=NGW_TOPNAV_UK_GU_COURSES">courses</a>
                    </li>
                    <li class="popup__item">
                        <a class="brand-bar__item--action" data-link-name="uk : topNav : holidays"
                        href="@holidaysUrl">holidays</a>
                    </li>
                </ul>
                <div class="brand-bar__popup--membership hide-from-desktop show-on-slim-header">
                    <h3 class="popup__group-header">support us:</h3>
                    <ul class="popup__group">
                        <li class="popup__item">
                            <a class="brand-bar__item--action js-acquisition-link" data-link-name="uk : topNav : membership"
                            href="@getReaderRevenueUrl(Membership, SlimHeaderDropdown)">membership</a>
                        </li>
                        <li class="popup__item">
                            <a class="brand-bar__item--action js-acquisition-link" data-link-name="uk : topNav : subscribe"
                            href="@getReaderRevenueUrl(Subscribe, SlimHeaderDropdown)">subscribe</a>
                        </li>
                    </ul>
                </div>
                @editionMenu()
            </div>
        </div>
    }
    @if(Edition(request) == Us){
        <div class="brand-bar__item brand-bar__item--jobs hide-until-tablet hide-on-slim-header">
            <a class="brand-bar__item--action" data-link-name="us : topNav : jobs"
               href="@jobsUrl("us")">find a job</a>
        </div>
    }
    @if(Edition(request) == Au){
        <div class="brand-bar__item brand-bar__item--masterclasses hide-until-tablet hide-on-slim-header">
            <a class="brand-bar__item--action" data-link-name="au : topNav : events"
                href="https://www.theguardian.com/guardian-live-australia">events</a>
        </div>
    }
    @if(Edition(request) == International){
        <div class="brand-bar__item brand-bar__item--jobs hide-until-tablet hide-on-slim-header">
            <a class="brand-bar__item--action" data-link-name="uk : topNav : jobs"
            href="@jobsUrl("int")">find a job</a>
        </div>
        <div class="brand-bar__item brand-bar__item--soulmates hide-until-desktop hide-on-slim-header">
            <a class="brand-bar__item--action" data-link-name="int : topNav : soulmates"
               href="@soulmatesUrl("int")">dating</a>
        </div>
        <div class="brand-bar__item has-popup brand-bar__item--has-control brand-bar__item--more">
            @ellipsis()
            <div class="popup popup--default is-off top-bar__popup--more" id="guardian-services-top-menu">
                <h3 class="popup__group-header">from the guardian:</h3>
                <ul class="popup__group">
                    <li class="popup__item brand-bar__popup--soulmates hide-from-desktop show-on-slim-header">
                        <a class="brand-bar__item--action" data-link-name="int : topNav : soulmates"
                           href="@soulmatesUrl("int")">dating</a>
                    </li>
                    <li class="popup__item brand-bar__popup--jobs">
                        <a class="brand-bar__item--action" data-link-name="int: topNav : jobs"
                        href="@jobsUrl("int")">find a job</a>
                    </li>
                </ul>
                @editionMenu()
            </div>
        </div>
    }
    <div class="brand-bar__item has-popup brand-bar__item--has-control brand-bar__item--edition hide-until-tablet hide-on-slim-header" data-component="edition">
        <a class="@RenderClasses(Map(
            "brand-bar__item--action" -> true,
            "popup__toggle" -> true
        ))"
           data-link-name="topNav : edition" data-toggle="top-bar__popup--edition"
           aria-haspopup="true" aria-controls="guardian-edition-menu">
            @Edition(request).displayName
        </a>
        <ul class="popup popup--default popup__group is-off top-bar__popup--edition" id="guardian-edition-menu">
            @Edition.others(request).map{ edition =>
                <li class="popup__item">
                    <a class="@RenderClasses(Map(
                        "brand-bar__item--action" -> true
                    ))" data-edition="@edition.id"
                        data-link-name="switch to @edition.id edition"
                        href="@LinkTo(s"/preference/edition/${edition.id.toLowerCase}")"
                        title="Switch to the @edition.id edition">
                        <span class="u-h">switch to the </span>
                        <span class="brand-bar__edition-name">@edition.displayName</span>
                    </a>
                </li>
            }
        </ul>
    </div>
</div>
