@(trail: model.Trail, index: Int, boostOverride: Option[Boolean] = Some(false))(implicit request: RequestHeader, config: model.Config)

@import common.LinkTo
@import model.{FaciaDisplayElement, InlineVideo}
@import views.support.{GetClasses, ImgSrc, Item220, Item300, Item620, SnapData}

@defining((trail.visualTone, boostOverride.getOrElse(trail.isBoosted), trail.imageHide )) { case (tone, isBoosted, imageHide) =>
    <div
        class="@GetClasses.forFromage(trail, isBoosted, imageHide)"
        @if(trail.isCommentable) {
            @trail.discussionId.map{ id =>
                data-discussion-id="@id"
            }
            data-discussion-closed="@trail.isClosedForComments"
        }
        data-link-name="trail | @{index + 1}"
        @SnapData(trail)>

        <div class="fromage__container">
            @FaciaDisplayElement.fromTrail(trail) match {
                case InlineVideo(videoElement, title, endSlatePath) if isBoosted => {
                    @fromageVideo(videoElement, title, true, endSlatePath)
                }
                case _ => {
                    @if(imageHide) {
                        @trail.trailPicture(5,3).map{ imageContainer =>
                            @ImgSrc.imager(imageContainer, Item620).map { imgSrc =>
                                <div class="fromage__media-wrapper fromage__media-wrapper--first">
                                    <div class="fromage__image-container u-responsive-ratio@if(isBoosted){ js-image-upgrade inlined-image" data-src="@imgSrc}">
                                    @if(isBoosted) {
                                        @Item300.bestFor(imageContainer).map{ url => <img src="@url" class="responsive-img" alt="" /> }
                                    } else {
                                        @Item220.bestFor(imageContainer).map{ url => <img src="@url" alt="" /> }
                                    }
                                    </div>
                                </div>
                            }
                        }
                    }
                }
            }
            @fragments.items.elements.title(trail, index, 0)

            @trail match { case content:model.Content => @fragments.items.elements.starRating(content) }

            @if(tone == "comment") {
                @trail.byline.map { byLine =>
                    @trail match { case content:model.Content =>
                        <p class="fromage__byline tone-colour">@ContributorLinks(Html(byLine), content.contributors)</p>
                    }
                }
            }

            @if(!isBoosted && !imageHide) {
                @trail.trailPicture(5,3).map{ imageContainer =>
                    @ImgSrc.imager(imageContainer, Item620).map { imgSrc =>
                        <a @LinkTo(trail).map{url=>href="@url"} data-link-name="article">
                            <div class="fromage__media-wrapper fromage__media-wrapper--second">
                                <div class="fromage__image-container u-responsive-ratio">
                                    @Item220.bestFor(imageContainer).map{ url => <img src="@url" alt="" /> }
                                </div>
                            </div>
                        </a>
                    }
                }
            }

            @trail match { case content:model.Content => @fragments.items.elements.tagOrSection(content) }

            @trail.trailText.map { text =>
                <div class="fromage__standfirst">@Html(text)</div>
            }

            <div class="u-faux-block-link__promote">
                @fragments.items.elements.supporting(trail.supporting, trail, style = "fit")
            </div>

            @if(trail.isCommentable) {
                @fragments.items.elements.meta(trail)
            }
        </div>
        <a @LinkTo(trail).map{url=>href="@url"} class="u-faux-block-link__overlay" data-link-name="article" tabindex="-1">@RemoveOuterParaHtml(trail.headline)</a>
    </div>
}
