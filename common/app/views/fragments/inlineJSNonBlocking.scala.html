@import common.InlineJs
@import conf.switches.Switches.{IdentityProfileNavigationSwitch,WebpackSwitch}
@import conf.Configuration
@import templates.inlineJS.nonBlocking.js._

@()(implicit request: RequestHeader)

@**
 * Use this fragment to add JavaScript that can improve the perceived rendering speed
 * but that is too blocking / risky to be put in the `head` of the document
 *@

<script>
// non-blocking JS to improve the perceived rendering speed
@InlineJs(getUserData().body, "getUserData.js")
@InlineJs(detectAdblock().body, "detectAdblock.js")

@if(IdentityProfileNavigationSwitch.isSwitchedOn) {
    // Insert username in top bar on page load
    @InlineJs(showUserName().body, "showUserName.js")
}

@if(mvt.ABNewNavVariant.canRun) {
    // editionalise new header navigation
    @InlineJs(editionaliseMenu().body, "editionaliseMenu.js")
}

// ************* ANALYTICS *************

// Ophan pageview ID and browser ID are needed by Google Analytics, which runs just after this script tag
@InlineJs(ophanConfig().body, "ophanConfig.js")

@if(WebpackSwitch.isSwitchedOn) {
    @HtmlFormat.raw(common.Assets.js.curl)

    [].slice.apply(document.querySelectorAll('figure.interactive[data-interactive]')).forEach(function (el) {
        require([el.getAttribute('data-interactive')], function (interactive) {
            interactive.boot(el, document, window.guardian.config);
        }, function (err) {
            console.log('Interactive failed', mainJS);
            console.log('Error:', err);
        });
        require(['ophan/ng'], function(ophan) {
            var a = el.querySelector('a');
            var href = a && a.href;

            if (href) {
                ophan.trackComponentAttention(href, el);
            }
        });
    });
}
</script>
