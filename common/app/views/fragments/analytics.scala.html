@(page: model.Page)( implicit request:RequestHeader)
@import conf.Configuration
@import common.AnalyticsHost
@import views.support.OmnitureAnalyticsData
@import conf.Static
@import conf.switches.Switches.BritishCouncilBeacon
@import conf.switches.Switches.GoogleAnalyticsSwitch
@import common.InlineJs


@fragments.omnitureScript(Some(page.metadata))

<script>
    // analytics code
    @InlineJs(templates.inlineJS.nonBlocking.js.analytics(), "analytics.js")
</script>


@defining(s"${request.host}${request.path}") { path =>

    @defining(
        s"${AnalyticsHost()}/b/ss/${Configuration.javascript.pageData("guardian.page.omnitureAccount")}/1/H.25.3/?${OmnitureAnalyticsData(page, "No Javascript", path)}"
    ){ omnitureCall =>
            <noscript id="omnitureNoScript">
                <div>
                    <img id="omnitureNoScriptImage" alt=""
                         src="@Html(omnitureCall)" width="1" height="1" class="u-h" />
                    <img id="omnitureConfidenceNoScriptImage" alt=""
                         src="@{Configuration.debug.beaconUrl}/count/pva.gif" width="1" height="1" class="u-h" />
                </div>
            </noscript>
    }

        <script>
            @*
                Basic Omniture runs on both Core & 'Full experience'
                We just need to run Ophan here.
            *@

            if (!guardian.isEnhanced) {
                var ophanScript = document.createElement('script'),
                        sc = document.getElementsByTagName('script')[0];

                ophanScript.src = '@Static("javascripts/bootstraps/enhanced/ophan.js")';
                ophanScript.async = true;
                sc.parentNode.insertBefore(ophanScript, sc);
            }
        </script>
}

@* google remarketing fallback *@
<noscript>
    <div style="display:inline;">
        <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/971225648/?value=0&amp;guid=ON&amp;script=0"/>
    </div>
</noscript>

<img src="@Configuration.debug.beaconUrl/count/pv.gif" alt="" style="display : none ;" rel="nofollow"/>

@if(GoogleAnalyticsSwitch.isSwitchedOn) {
    <script id='google_analytics'>
        @InlineJs(templates.inlineJS.nonBlocking.js.googleAnalytics(page), "googleAnalytics.js")
    </script>

    @*
        If at some point in the future this goes live, please somebody think of the "noscript" for Google Analytics
    *@
}

@if(BritishCouncilBeacon.isSwitchedOn && page.metadata.url.contains("british-council-partner-zone")) {
    <img alt="DCSIMG" id="DCSIMG" width="1" height="1"
    src="http://statse.webtrendslive.com/dcsozkqgb00000sh0y1unaabw_9e3r/njs.gif?dcssip=www.guardian.co.uk&amp;dcsuri=/british-council-partner-zone&amp;WT.dl=0&amp;WT.es=www.guardian.co.uk/british-council-partner-zone&amp;WT.sp=Guardian_British_Council_Zone&amp;WT.js=No&amp;WT.tv=BC.nojs.1"/>
}
