@(storyquestions: model.content.StoryQuestionsAtom, isAmp: Boolean)(implicit request: RequestHeader)

@import org.joda.time.{DateTime, DateTimeZone}

@isClosed() = @{
    storyquestions.data.closeDate.exists { closeDate =>
        closeDate < DateTime.now(DateTimeZone.UTC).getMillis
    }
}

@if(!isAmp && !isClosed) {
    <div class="js-view-tracking-component submeta user__question" data-atom-id="@storyquestions.id">

        @defining("test/test" == storyquestions.data.relatedStoryId && storyquestions.atom.labels.exists(_.length == 4)) { isEmailSubmissionReady =>
            <span class="is-hidden" id="js-storyquestion-is-email-submission-ready" data-is-email-submission-ready="@isEmailSubmissionReady"></span>
        }

        <h2 class="user__question-title">
            Ask us a question
            <span class="user__question-title--secondary">We will answer the most popular question later today.</span>
        </h2>

        @for(questions <- storyquestions.data.editorialQuestions) {
            @for(qs <- questions) {
                <div class="user__question-section">
                    @for(question <- qs.questions) {
                        <div class="user__question-container">
                            <label><input type="checkbox" name="checkbox" value="@question.questionId">@question.questionText</label>
                        </div>
                    }
                </div>

                <button type="submit" class="js-storyquestion-vote-button storyquestion-vote-button button button--primary">Vote</button>

                @storyquestions.atom.labels.find(_.length == 4).map { listId =>

                    <div class="is-hidden js-storyquestion-email-question storyquestion-email-question">We're working on the answer. Would you like to receive an email when we answer the most popular question?</div>

                    <label for="#email-input-@listId" class="is-hidden js-storyquestion-email-enter storyquestion-email-enter">Enter your email</label>

                    <div class="is-hidden js-storyquestion-email-done storyquestion-email-done">We will email you the answer to the most popular question as soon as it's ready.</div>

                    <a href="#email-input-@listId" class="is-hidden js-storyquestion-email-question-button storyquestion-email-question-button button button--primary">Email me</a>

                    <form action="#" class="is-hidden storyquestion-email-signup-form js-storyquestion-email-signup-form form">
                        <div class="form-field js-storyquestion-email-signup-input-container">
                            <input id="email-input-@listId" aria-describedby="no-spam-@qs.questionSetId" class="text-input js-storyquestion-email-signup-input" type="email" name="email" placeholder="Email address" required />
                        </div>
                        <input class="" type="hidden" name="listId" value="@listId" />
                        <button type="submit" class="js-storyquestion-email-signup-button button button--primary button--with-input">
                            @fragments.inlineSvg("envelope", "icon", Seq("submit-input__icon"))
                            Sign up
                        </button>
                    </form>
                }

                <div id="no-spam-@qs.questionSetId" class="is-hidden js-storyquestion-email-nospam">No spam, just one email</div>
            }
    </div>
}

}
