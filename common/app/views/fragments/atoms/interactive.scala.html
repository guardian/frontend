@import common.InlineJs
@import model.content.InteractiveAtom
@import templates.inlineJS.nonBlocking.js.{interactiveFonts, interactiveResize}

@(interactive: InteractiveAtom, shouldFence: Boolean, isAmp: Boolean)(implicit context: model.ApplicationContext)

@iframeBody = {
    <!DOCTYPE html>
    <html>
        <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
            <script>
                @InlineJs(interactiveFonts().body, "interactiveFonts.js")
            </script>
            <style>
                @HtmlFormat.raw(interactive.css)
            </style>
        </head>
        <body>
            @HtmlFormat.raw(interactive.html)

            @for(js <- interactive.mainJS) {
                <script>
                    @HtmlFormat.raw(js)
                </script>
            }
            <script>
                @InlineJs(interactiveResize().body, "interactiveResize.js")
            </script>
        </body>
    </html>
}

@if(shouldFence) {
    @if(isAmp) {
        <amp-iframe class="interactive-atom-fence"
                    srcdoc="@iframeBody.toString"
                    layout="responsive"
                    sandbox="allow-scripts allow-popups"
                    width="500"
                    height="200"
                    resizable
                    placeholder="">
            <div class="cta cta--medium cta--show-more cta--show-more__unindent"
                 overflow
                 tabindex=0
                 role=button
                 aria-label="See the full visual">
                See the full visual
            </div>
        </amp-iframe>
    } else {
        <iframe class="interactive-atom-fence" srcdoc="@iframeBody.toString"></iframe>
    }
} else {
    <figure class="interactive interactive-atom">
        <style>
            @HtmlFormat.raw(interactive.css)
        </style>
        @HtmlFormat.raw(interactive.html)
        @for(js <- interactive.mainJS) {
            <script>
                @HtmlFormat.raw(js)
            </script>
        }
    </figure>
}
