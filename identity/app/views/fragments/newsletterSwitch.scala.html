@import common.LinkTo
@import _root_.form.IdFormHelpers.nonInputFields
@import views.support.fragment.Switch._
@import services.newsletters.NewsletterResponse

@* Editorial Newsletter switch/checkbox *@

@(
    emailPrefsForm: Form[_],
    emailSubscriptions: List[String],
    newsletter: NewsletterResponse,
    unchecked: Boolean = false,
    skin: Option[String] = None
)(implicit handler: views.html.helper.FieldConstructor, messages: play.api.i18n.Messages, request: RequestHeader)

@buildFooter(newsletter: NewsletterResponse) = {
    <div class="manage-account__switch-footer-tidbit">
        @fragments.inlineSvg("clock", "icon", List("inline-icon--light-grey"))
        @newsletter.frequency
    </div>
    @if(newsletter.exampleUrl.isDefined){
        <a class="u-underline manage-account__switch-footer-email-preview" target="preview-email-@newsletterListId" href="@LinkTo({ newsletter.exampleUrl.getOrElse("") })">
            See the latest email
        </a>
    }
}

@newsletterListId = @{
    newsletter.listId.toString
}

@checkboxValue = @{
    if (unchecked)
        None
    else {
        Some(emailSubscriptions.contains(newsletter.listId.toString).toString)
    }
}

@newsletterField = @{
    new Field(
        form = emailPrefsForm,
        name = newsletterListId,
        constraints = Nil,
        format = None,
        errors = Nil,
        value = checkboxValue
    )
}

@fragments.form.switch(
    title = newsletter.name,
    description = Some(newsletter.description),
    behaviour = NewsletterSwitch,
    field = newsletterField,
    extraFields = Nil,
    footer = Some(buildFooter(newsletter)),
    skin = skin,
    newsletterIdentityName = Some(newsletter.identityName)
)(nonInputFields, messages)
