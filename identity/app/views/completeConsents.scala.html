@import com.gu.identity.model.EmailNewsletters
@import services.EmailPrefsData

@import controllers.editprofile.GuestPasswordFormData
@(
    idRequest: services.IdentityRequest,
    idUrlBuilder: services.IdentityUrlBuilder,
    returnUrl: String,
    emailPrefsForm: Form[EmailPrefsData],
    setPasswordForm: Form[GuestPasswordFormData],
    emailSubscriptions: List[String],
    availableLists: EmailNewsletters,
)(implicit request: RequestHeader, messages: play.api.i18n.Messages)

@import common.LinkTo
@import form.IdFormHelpers._
@import views.html.fragments.form.inputField
@import views.html.fragments.registrationFooter

@buildIdentityUrl(endpoint: String) = {
@idUrlBuilder.buildUrl(s"/$endpoint", idRequest)
}

<div class="identity-wrapper monocolumn-wrapper">
    <section class="identity-forms-message">
        <h1 class="identity-title">Thank you! We've got your preferences</h1>
        <div class="identity-forms-message__body">
            <p>You can change these anytime by going to My account > <a class="u-underline" data-link-name="complete-consents : to-email-prefs" href="@idUrlBuilder.buildUrl(controllers.editprofile.routes.EditProfileController.displayEmailPrefsForm(false, None).url, idRequest)">
                Email Preferences
            </a>.</p>
            <br/>
        </div>
        @if(!emailPrefsForm.globalError) {
            <form>
                @views.html.helper.CSRF.formField
                <div>
                    <h1 class="identity-title--small">Before you go...</h1>
                    <div class="identity-forms-message__body">
                        <p>Did you know that we have <b>more than 40</b> different email newsletters that focus on a range of diverse topics - from politics and the latest tech to documentaries, sport and scientific breakthroughs.</p>
                        <p>Why not take a few seconds to see whether there is anything here for you?</p>
                    </div>
                    <div class="fieldset__fields">
                        @fragments.emailListCategories(emailPrefsForm, availableLists, emailSubscriptions)(request, messages)
                    </div>
                    <p class="identity-title-explainer identity-title-explainer--small">
                        The Guardian's newsletters include content from our website, which may be funded by outside parties. Newsletters may also display information about Guardian News and Media's other products, services or events (such as Guardian Jobs or Masterclasses), chosen charities or online advertisements.
                    </p>
                </div>
            </form>
        }

        @if(request.cookies.get("SC_GU_GUEST_PW_SET").isDefined) {
            <form class="form js-identity-upsell-account-creation" novalidate action="/password/guest" role="form" method="post">
                <fieldset class="fieldset">
                    @views.html.helper.CSRF.formField
                    <div>
                        <h1 class="identity-title--small">Want even more from the Guardian? Create a free account</h1>
                        <div class="identity-forms-message__body">
                            <p>Create your account by setting a password, and manage your email preferences at any time.</p>
                        </div>
                        <div class="fieldset__fields">
                            <input type="hidden" value="@request.cookies.get("SC_GU_GUEST_PW_SET").get.value" name="token" />

                            @inputField(Password(setPasswordForm("password"), ('_label, "Password"), ('class, "js-register-password"),
                            ('tabindex, 1), ('maxlength, 72), (Symbol("data-test-id"), "password"), (Symbol("data-link-name"), "set-password")))
                            <li class="form-field form-field__submit">
                                <button type="submit" class="manage-account__button manage-account__button--center" tabindex="4">Set password</button>
                            </li>
                        </div>
                    </div>
                </fieldset>
            </form>
        }
        <aside class="identity-forms-message__body">
            <a class="manage-account__button manage-account__button--secondary" data-link-name="complete-consents : cta-bottom" href="@LinkTo(returnUrl)">
                Go to the theguardian.com
                @fragments.inlineSvg("arrow-right", "icon")
            </a>
        </aside>
    </section>
</div>
