@import idapiclient.responses.Error
@import model.{IdentityUserhelp, MembershipUserhelp, DigitalPackUserhelp} // TODO how can I use this in templates?

@(
    page: model.Page,
    idRequest: services.IdentityRequest,
    idUrlBuilder: services.IdentityUrlBuilder,
    errors: List[Error],
    user: com.gu.identity.model.User,
    userContentAccess: services.ContentAccess
)(implicit
    request: RequestHeader,
    messages: play.api.i18n.Messages,
    context: model.ApplicationContext,
)

@import views.html.fragments.registrationFooter

@emailIsValidated = @{
    user.statusFields.userEmailValidated.fold(false)(identity)
}

@printSubscriptionType = @{
    if(userContentAccess.isPaperSubscriber && userContentAccess.isGuardianWeeklySubscriber) {
       <span><strong>Guardian</strong> and <strong>Guardian Weekly</strong></span>
    }
    else if(userContentAccess.isPaperSubscriber) {
        <strong>Guardian</strong>
    }
    else if(userContentAccess.isGuardianWeeklySubscriber) {
        <strong>Guardian Weekly</strong>
    }
}


<div class="identity-wrapper monocolumn-wrapper">


    @if(emailIsValidated) {


        <div class="identity-section">

            @if(userContentAccess.isMember || userContentAccess.isPaidMember || userContentAccess.isRecurringContributor || userContentAccess.hasDigitalPack) {

                <p class="identity-section__text">
                    We've noticed you have an active membership, recurring contribution or digital subscription with the Guardian, so you won't be able to automatically delete your account online. Please follow the instructions below first and try again if you would still like delete your account.
                </p>

                </br>
                <h4>How to delete your account if...</h4>

                </br>
                @if(userContentAccess.isMember || userContentAccess.isPaidMember) {
                    <h4>
                        You have an active membership</h4>
                    <p class="identity-section__text">
                        You must first cancel your membership before you can delete your account online. To cancel your membership
                        please <a class="u-underline" href="https://membership.theguardian.com/tier/cancel">
                        click here.</a>
                    </p>
                }

                </br>
                @if(userContentAccess.isRecurringContributor) {
                    <h4>
                        You have a recurring contribution</h4>
                    <p class="identity-section__text">
                        You must first cancel your recurring contribution before you can delete your account online. To cancel this <a class="u-underline" href="https://manage.theguardian.com/cancel/contributions">
                        click here.</a>
                    </p>
                }

                </br>
                @if(userContentAccess.hasDigitalPack) {
                    <h4>
                        You have an active Digital Pack subscription</h4>
                    <p class="identity-section__text">
                        You cannot delete your account while you have an active Digital Pack subscription. If you would like to cancel your subscription,
                        please email the <a class="u-underline" href="mailto:subscriptions@@theguardian.com">
                        Subscriptions Team.</a>
                    </p>
                }
            }

        </br>
            @if(userContentAccess.isPaperSubscriber || userContentAccess.isGuardianWeeklySubscriber) {

                <h4>
                    You have an active print subscription
                </h4>
                <p class="identity-section__text">
                    We've noticed you have an active subscription to the @{
                    printSubscriptionType
                }. You can keep your print subscription and still delete your online Guardian account, but you will no longer be able to manage your subscription online.
                </p>

                <p class="identity-section__text">
                    If you would like to cancel your print subscription,
                    please email the
                    <a class="u-underline" href="mailto:subscriptions@@theguardian.com">
                        Subscriptions Team.
                    </a>
                </p>

                <p class="identity-section__text">
                    If you would like to delete your online account, you can <a class="u-underline" href="@idUrlBuilder.buildUrl("/delete/form", idRequest)" >
                    click here
                </a> to proceed with an account deletion request.
                </p>
            }
        </div >

        </br>
        <p class="identity-section__text">
            If at any point you require further clarification, please
            email our
            <a class="u-underline" href="mailto:@{IdentityUserhelp.email}" data-link-name="Email Userhelp">
                Userhelp
            </a>
            who will
            be happy to help.
        </p>

    } else {
        <div class="identity-section">
            <p class="identity-section__text">
                Before you can delete your account you need to validate your email address.
                Once you have validated, please reload this page and you will be able to delete
                your account.
            </p>
            <a class="u-underline js-id-send-validation-email" data-link-name="Resend verification email">
                Send validation email
            </a>
        </div>
    }

    @registrationFooter(idRequest, idUrlBuilder)
</div >

