@(offlineCrossword: controllers.OfflineCrossword)(implicit request: RequestHeader)

@import play.api.libs.json._
@import conf.switches.Switches._
@import common.InlineJs
@import templates.inlineJS.blocking.js._
@import conf.{Configuration, Static}

<!DOCTYPE html>
<html id="js-context" class="js-off is-not-modern id--signed-out" data-page-path="@request.path">

<head>
    <meta charset="utf-8" />
    <title>@views.support.Title(offlineCrossword)</title>

    @fragments.metaData(offlineCrossword)

    @* get the stylesheets downloading ASAP *@
    @fragments.stylesheets(None)

    @* We don't use the inlineJSBlocking template because we need to specify
    our own paths *@

    @fragments.analytics.omnitureScript(Some(offlineCrossword.metadata))

    @* NOTE the order of these includes is important  *@
    <script>
        @* Service worker only caches the bundles (including in dev),
        so the offline page can only ask for those. *@
        window.curlConfig = {
            baseUrl: '@{Configuration.assets.path}javascripts',
            apiName: 'require',
            paths: {
                'ophan/ng':                 '@{Configuration.javascript.config("ophanJsUrl")}',
                text:                       'text', // noop
                inlineSvg:                  'inlineSvg', // noop

                'bootstraps/enhanced/main':      '@Static("javascripts/bootstraps/enhanced/main.js")',
                'bootstraps/commercial':          '@Static("javascripts/bootstraps/commercial.js")',
                'bootstraps/enhanced/crosswords': '@Static("javascripts/bootstraps/enhanced/crosswords.js")',

                'react': '@Static("javascripts/components/react/react.js")'
            }
        };

        // curl will read from window.curl
        window.curl = window.curlConfig;

        // Polyfill for async script
        (function (document) {
            var script = document.createElement('script');
            script.src = '@Static("javascripts/app.js")';
            var ref = document.getElementsByTagName('script')[0];
            ref.parentNode.insertBefore(script, ref);
        })(document);

        // polyfills
        @Html(polyfills().body)

        // determine whether to run enhanced JS
        @InlineJs(shouldEnhance(offlineCrossword.metadata).body, "shouldEnhance.js")

        // page config
        @Html(config(offlineCrossword).body)

        // apply render conditions
        @InlineJs(applyRenderConditions().body, "applyRenderConditions.js")

        // try and load fonts before we use the stylesheets
        @if(FontSwitch.isSwitchedOn) {
            @InlineJs(loadFonts().body, "loadFonts.js")
        }

        @if(AsyncCss.isSwitchedOn) {
            // enable non-blocking stylesheets
            // borrows *heavily* from https://github.com/filamentgroup/loadCSS.
            @InlineJs(enableStylesheets().body, "enableStylesheets.js")
        }
    </script>
</head>
    <body
        id="top"
        itemscope itemtype="http://schema.org/WebPage">

        <a class="u-h skip" href="#maincontent" data-link-name="skip : main content">Skip to main content</a>

        @fragments.header(offlineCrossword)

        <div class="l-side-margins">
            <article id="crossword" class="content content--article tonal tonal--tone-news" role="main">
                <div class="content__head tonal__head tonal__head--tone-news">
                    <div class="gs-container">
                        <div class="content__main-column content__main-column--single-column">
                            <h1 class="content__headline">Unable to connect to the Internet</h1>
                            <p>In the meantime, how about a quick crossword?</p>
                            <button class="button js-open-crossword-btn">Open crossword</button>
                        </div>
                        <div class="js-crossword-container is-hidden u-baseline-top">
                            <h2><a href="/crosswords/@offlineCrossword.crossword.id">@offlineCrossword.crossword.name</a></h2>
                            <div class="js-crossword"
                                data-crossword-data="@Json.stringify(Json.toJson(offlineCrossword.crossword))">
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </div>

        @fragments.footer(offlineCrossword)

        @fragments.inlineJSNonBlocking()

        @fragments.analytics.base(offlineCrossword)

    </body>
</html>
